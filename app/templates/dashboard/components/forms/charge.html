<!-- app/templates/components/forms/charge.html -->
<div class="charge-form-component">
    <form id="chargeForm" class="needs-validation" novalidate data-form-type="charge">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    {% if charge %}
                        Edit Charge
                    {% else %}
                        New Charge
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                <!-- Hidden Fields -->
                <input type="hidden" name="created_by" value="hnejadi">
                <input type="hidden" name="created_at" value="2025-01-08T16:29:20Z">

                <div class="row">
                    <!-- Charge Type -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="chargeType">Charge Type <span class="text-danger">*</span></label>
                            <select class="form-control select2-field" id="chargeType" name="charge_type" required
                                    data-validation='{"required": true}'>
                                <option value="">Select Charge Type</option>
                                <option value="rent">Rent</option>
                                <option value="utility">Utility</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="deposit">Security Deposit</option>
                                <option value="late_fee">Late Fee</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback">Please select a charge type</div>
                        </div>
                    </div>

                    <!-- Amount -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="amount">Amount <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input type="text" class="form-control currency-input" id="amount" name="amount"
                                       required data-validation='{"required": true, "pattern": "^\\d+(\\.\\d{2})?$", "patternMessage": "Please enter a valid amount"}'>
                                <div class="invalid-feedback">Please enter a valid amount</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Due Date -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="dueDate">Due Date <span class="text-danger">*</span></label>
                            <input type="text" class="form-control datepicker" id="dueDate" name="due_date"
                                   required data-validation='{"required": true}'>
                            <div class="invalid-feedback">Please select a due date</div>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select class="form-control select2-field" id="status" name="status">
                                <option value="pending">Pending</option>
                                <option value="paid">Paid</option>
                                <option value="overdue">Overdue</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Unit -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="unit">Unit <span class="text-danger">*</span></label>
                            <select class="form-control select2-field" id="unit" name="unit_id" required
                                    data-validation='{"required": true}'>
                                <option value="">Select Unit</option>
                                {% for unit in units %}
                                    <option value="{{ unit.id }}">{{ unit.number }} - {{ unit.building.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">Please select a unit</div>
                        </div>
                    </div>

                    <!-- Tenant -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="tenant">Tenant <span class="text-danger">*</span></label>
                            <select class="form-control select2-field" id="tenant" name="tenant_id" required
                                    data-validation='{"required": true}'>
                                <option value="">Select Tenant</option>
                                <!-- Populated dynamically based on unit selection -->
                            </select>
                            <div class="invalid-feedback">Please select a tenant</div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="3"
                              data-validation='{"maxLength": 500}'></textarea>
                    <div class="invalid-feedback">Description cannot exceed 500 characters</div>
                </div>

                <!-- Recurring Charge Options -->
                <div class="form-group">
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="isRecurring" name="is_recurring">
                        <label class="custom-control-label" for="isRecurring">Make this a recurring charge</label>
                    </div>
                </div>

                <div id="recurringOptions" class="d-none">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="frequency">Frequency</label>
                                <select class="form-control" id="frequency" name="frequency">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="endDate">End Date</label>
                                <input type="text" class="form-control datepicker" id="endDate" name="end_date">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attachments -->
                <div class="form-group">
                    <label>Attachments</label>
                    <div class="dropzone" id="chargeAttachments">
                        <div class="dz-message">
                            Drop files here or click to upload<br>
                            <small class="text-muted">(Max file size: 5MB)</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <div class="row">
                    <div class="col">
                        <button type="button" class="btn btn-secondary" onclick="window.history.back()">Cancel</button>
                    </div>
                    <div class="col text-right">
                        <button type="button" class="btn btn-primary" onclick="saveAsDraft()">Save as Draft</button>
                        <button type="submit" class="btn btn-success">Submit Charge</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Toast Container for Notifications -->
<div id="toastContainer" class="position-fixed bottom-0 right-0 p-3" style="z-index: 1050">
</div>

<style>
.charge-form-component .card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.charge-form-component .form-group {
    margin-bottom: 1rem;
}

.charge-form-component .select2-container--bootstrap4 .select2-selection {
    height: calc(1.5em + 0.75rem + 2px);
}

.charge-form-component .dropzone {
    border: 2px dashed #dee2e6;
    border-radius: 0.25rem;
    background: #f8f9fa;
    min-height: 150px;
}

.charge-form-component .dropzone .dz-message {
    margin: 2em 0;
    text-align: center;
}

.charge-form-component .custom-switch {
    padding-left: 2.25rem;
}

.charge-form-component .invalid-feedback {
    display: none;
    font-size: 80%;
}

.charge-form-component .was-validated .form-control:invalid ~ .invalid-feedback {
    display: block;
}

@media (max-width: 768px) {
    .charge-form-component .card-footer .row {
        flex-direction: column-reverse;
    }

    .charge-form-component .card-footer .col {
        text-align: center;
        margin-bottom: 0.5rem;
    }

    .charge-form-component .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
}
</style>

<!-- Script section is in the separate scripts.js file -->