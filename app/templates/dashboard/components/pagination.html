<!-- app/templates/components/pagination.html -->
{% macro render_pagination(pagination, endpoint, **kwargs) %}
<div class="pagination-component">
    <div class="d-flex justify-content-between align-items-center">
        <!-- Items per page selector -->
        <div class="items-per-page">
            <select class="form-control form-control-sm" id="itemsPerPage" onchange="changeItemsPerPage(this.value)">
                <option value="10" {% if pagination.per_page == 10 %}selected{% endif %}>10 per page</option>
                <option value="25" {% if pagination.per_page == 25 %}selected{% endif %}>25 per page</option>
                <option value="50" {% if pagination.per_page == 50 %}selected{% endif %}>50 per page</option>
                <option value="100" {% if pagination.per_page == 100 %}selected{% endif %}>100 per page</option>
            </select>
        </div>

        <!-- Pagination information -->
        <div class="pagination-info text-muted">
            Showing {{ pagination.first_item }} to {{ pagination.last_item }}
            of {{ pagination.total }} entries
            <span class="last-updated ml-2">
                (Updated: {{ moment.utc('2025-01-08 16:20:32').fromNow() }})
            </span>
        </div>

        <!-- Pagination controls -->
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm mb-0">
                <!-- First page -->
                <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for(endpoint, page=1, **kwargs) }}" aria-label="First">
                        <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                </li>

                <!-- Previous page -->
                <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for(endpoint, page=pagination.prev_num, **kwargs) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <!-- Page numbers -->
                {%- for page in pagination.iter_pages(left_edge=2, left_current=2, right_current=3, right_edge=2) %}
                    {% if page %}
                        <li class="page-item {% if page == pagination.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for(endpoint, page=page, **kwargs) }}">{{ page }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    {% endif %}
                {%- endfor %}

                <!-- Next page -->
                <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for(endpoint, page=pagination.next_num, **kwargs) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>

                <!-- Last page -->
                <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for(endpoint, page=pagination.pages, **kwargs) }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<style>
.pagination-component {
    background-color: #f8f9fa;
    padding: 0.75rem;
    border-radius: 0.25rem;
    margin: 1rem 0;
}

.pagination {
    margin: 0;
}

.page-link {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.5;
    color: #007bff;
    background-color: #fff;
    border: 1px solid #dee2e6;
}

.page-item.active .page-link {
    background-color: #007bff;
    border-color: #007bff;
}

.page-item.disabled .page-link {
    color: #6c757d;
    pointer-events: none;
    background-color: #fff;
    border-color: #dee2e6;
}

.items-per-page {
    width: 120px;
}

.items-per-page select {
    height: calc(1.5em + 0.5rem + 2px);
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.pagination-info {
    font-size: 0.875rem;
}

.last-updated {
    color: #6c757d;
    font-style: italic;
}

@media (max-width: 768px) {
    .pagination-component {
        flex-direction: column;
        align-items: center;
    }

    .pagination-info {
        margin: 0.5rem 0;
        text-align: center;
    }

    .items-per-page {
        margin-bottom: 0.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    initializePagination();
});

function initializePagination() {
    // Store user preferences
    const userPreferences = {
        itemsPerPage: localStorage.getItem('itemsPerPage') || 25,
        lastAccess: '2025-01-08T16:20:32Z',
        username: 'hnejadi'
    };

    // Set initial items per page
    const itemsPerPageSelect = document.getElementById('itemsPerPage');
    if (itemsPerPageSelect) {
        itemsPerPageSelect.value = userPreferences.itemsPerPage;
    }

    // Update last accessed time
    updateLastAccessTime();
}

function changeItemsPerPage(value) {
    // Store user preference
    localStorage.setItem('itemsPerPage', value);

    // Reload current page with new items per page
    const url = new URL(window.location.href);
    url.searchParams.set('per_page', value);
    url.searchParams.set('page', '1'); // Reset to first page
    window.location.href = url.toString();
}

function updateLastAccessTime() {
    const lastUpdated = document.querySelector('.last-updated');
    if (lastUpdated) {
        setInterval(() => {
            lastUpdated.textContent = `(Updated: ${moment.utc('2025-01-08 16:20:32').fromNow()})`;
        }, 60000); // Update every minute
    }
}

// Export functions for testing
window.paginationUtils = {
    changeItemsPerPage,
    updateLastAccessTime
};
</script>
{% endmacro %}